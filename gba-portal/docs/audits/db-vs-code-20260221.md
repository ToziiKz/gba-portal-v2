# Audit DB ↔ Code (2026-02-21)

## 1. Structure Réelle de la Base de Données (Production/Supabase)

Suite à l'extraction de l'information schema, voici la réalité de la structure des données critiques.

### Différences majeures identifiées (Responsables des précédents bugs) :

1. **`teams`** : Utilise la colonne `gender` (et non `sex` comme supposé dans les scripts).
2. **`players`** : L'ID est bien un `bigint` (entier), possède une colonne `team_id` (ce qui valide notre RLS Effectif), et utilise `lastname`/`firstname`.
3. **`planning_sessions`** : Utilise les types `time without time zone` pour `start_time` et `end_time`, et un array pour `staff`.
4. **`matches`** : Possède des champs optionnels supplémentaires (`location`, `competition`).

### Liste des tables publiques existantes :

- `access_admin_events`
- `approval_requests`
- `attendance`
- `categories`
- `coach_access_requests`
- `coach_invitations`
- `competitions`
- `licence_payments`
- `licences`
- `match_lineups`
- `matches`
- `planning_sessions`
- `players`
- `profiles`
- `relances`
- `role_permissions`
- `staff_profiles`
- `staff_team_memberships`
- `teams`
- `user_scopes`

## 2. Conclusion

La base de données est propre. Il n'y a **aucune table déchet**.
Les erreurs précédentes venaient exclusivement de l'utilisation du mot `sex` au lieu de `gender` dans les requêtes de seed de test. Les politiques de sécurité (RLS) que nous avons mises en place (basées sur `team_id` et `coach_id`) sont **parfaitement alignées** avec ce schéma.
